
apiVersion: v1
kind: ConfigMap
metadata:
  name: tomee-configmap
  namespace: ava-server
data:
  tomee.xml: |
    <?xml version="1.0" encoding="UTF-8"?>
    <!--
        Licensed to the Apache Software Foundation (ASF) under one or more
        contributor license agreements.  See the NOTICE file distributed with
        this work for additional information regarding copyright ownership.
        The ASF licenses this file to You under the Apache License, Version 2.0
        (the "License"); you may not use this file except in compliance with
        the License.  You may obtain a copy of the License at

          http://www.apache.org/licenses/LICENSE-2.0

        Unless required by applicable law or agreed to in writing, software
        distributed under the License is distributed on an "AS IS" BASIS,
        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
        See the License for the specific language governing permissions and
        limitations under the License.
    -->
    <tomee>
      <!-- see https://tomee.apache.org/latest/docs/admin/configuration/containers.html -->
      <!-- activate next line to be able to deploy applications in apps -->
      <!-- <Deployments dir="apps" />-->
      <Resource id="j30DatabaseManaged" type="DataSource">#  PostgreSQL example
        #
        #  This connector will not work until you download the driver at:
        #  http://jdbc.postgresql.org/download.html
        JdbcDriver   org.postgresql.Driver
        JdbcUrl  jdbc:postgresql://dev-rds.eatwithava.com:5432/dev
        UserName     ava_server
        Password     E9WE_tRg4_5E
        testOnBorrow    true
        validationQuery SELECT 1
    </Resource>
      <Resource id="readReplicaManaged" type="DataSource">#  PostgreSQL example
        #
        #  This connector will not work until you download the driver at:
        #  http://jdbc.postgresql.org/download.html
        JdbcDriver   org.postgresql.Driver
        JdbcUrl  jdbc:postgresql://dev-rds.eatwithava.com:5432/dev?readOnly=true
        UserName     ava_server
        Password     E9WE_tRg4_5E
        testOnBorrow    true
        validationQuery SELECT 1
    </Resource>
      <Resource id="MyJmsResourceAdapter" type="ActiveMQResourceAdapter">
            # Do not start the embedded ActiveMQ broker; Connect to the external ActiveMQ broker
            BrokerXmlConfig =
            <!-- NOTE(eslavich): Use nio:// instead of tcp:// so that the "transport thread" shuts down properly -->
            <!-- NOTE: Using nio+ssl for Amazon MQ -->
            ServerUrl = nio://activemq-service.ava-server.svc.cluster.local:61616
            UserName =
            Password =
        </Resource>
      <Resource id="MyJmsConnectionFactory" type="javax.jms.ConnectionFactory">ResourceAdapter = MyJmsResourceAdapter
          poolMaxSize = 100
          poolMinSize = 5
        </Resource>
      <Container ctype="MESSAGE" id="MyJmsMdbContainer">ResourceAdapter = MyJmsResourceAdapter
        </Container>
      <!--- https://tomee.apache.org/admin/configuration/containers.html -->
      <Container id="Default Stateless Container" type="STATELESS">AccessTimeout = 30 seconds
            MaxSize = 10
            MinSize = 2
            StrictPooling = true
            MaxAge = 1 hours
            ReplaceAged = true
            ReplaceFlushed = false
            MaxAgeOffset = -1
            IdleTimeout = 5 minutes
            GarbageCollection = false
            SweepInterval = 5 minutes
            CallbackThreads = 5
            CloseTimeout = 5 minutes
            UseOneSchedulerThreadByBean = false
            EvictionThreads = 1
        </Container>
    </tomee>
